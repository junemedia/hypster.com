<!DOCTYPE html>

@model hypster.ViewModels.videoPlayerViewModel
@{
    Layout = null;
    int song_limit = Int32.Parse(System.Configuration.ConfigurationManager.AppSettings["Song_LIMIT"]);
}


<html>
    <head>
        <meta charset="utf-8" />
        <meta id="vpM" name="viewport" content="width=device-width, initial-scale=1">
        <title>@ViewBag.PageTitle</title>
        <meta name="description" content="@ViewBag.Desc Create a free music playlist and listen to 10 millions music playlists." />

        <link src="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css"  rel="stylesheet" type="text/css" />
        <script src="http://code.jquery.com/jquery-1.8.3.min.js"  type="text/javascript"></script>
        <script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"  type="text/javascript"></script>
        <script src="http://ajax.aspnetcdn.com/ajax/mvc/3.0/jquery.unobtrusive-ajax.min.js" type="text/javascript"></script>
        @Scripts.Render("~/bundlesNewsMPL/scripts")
        <link id="mStyles1" href="/areas/apps/css/appSite2.css?id=62729381" rel="stylesheet" type="text/css" />
        <link id="appPlayer1" href="/areas/apps/css/appPlayerNews.css?id=62729381" rel="stylesheet" type="text/css" />
    </head>
    <body class="MainNHypPlayer"  onclick="$('#tapMessage').css('display','none');" style="background:#454545;">
        <div class="MainRootCont">
            <div style="float:left; width:100%;">
                <div id="MainContHolder">
                    <div class="MainPlayerHoder" style="min-height:229px;">
                        <div id="player"></div>
                        <div id="PlaybackStatusCont1" style="float:left; width:100%; height:3px; background-color:#656565; cursor:pointer; " onmouseover="PSC_over()" onmouseout="PSC_out()">
                            <div id="PlaybackStatusInnrCont1" style="position:relative; width:100%; height:3px; background-color:#656565; cursor:pointer; z-index:10000;">
                                <div id="PlaybackStatus1" style="float:left; width:0%; height:3px; background-color:#f9a317;"></div>
                            </div>
                        </div>

                        <div class="ControlBar">            
                            <div id="Prev_btn" onclick="PlayPrevVideo();" title="Prev"></div>
                            <div id="PlPs_btn" onclick="PlayPauseVideo();" title="Play/Pause"></div>
                            <div id="Next_btn" onclick="PlayNextVideo();" title="Next"></div>
                            <div id="Shuffle_btn" onclick="ShuffleSongs();" title="Shuffle"></div>
                            <div id="Mute_btn_cont" onmouseover="SoundMouseOver();" onmouseout="SoundMouseOut();" title="Mute/Unmute">
                                <div id="Mute_btn" onclick="MuteSound();" title="Mute/Unmute"></div>
                                <div id="VolumeControl"><div id="VolumeControlVal"></div></div>
                            </div>

                            <div class="AddSongPlstBtn" onclick="AddSong_CLICK()" style="@if (User.Identity.IsAuthenticated == false){<text>display:none;</text>} float:right; height:38px; line-height:32px; margin:2px; background:#353535; border-radius:3px; text-align:center; font-size:16px; color:#FFFFFF; cursor:pointer; font-weight:bold;">                        
                                <div id="addsngtxt" style="float:right; min-width:10px; margin:0px 4px 0 2px; font-size:32px; color:#3fbc91; cursor:pointer;">
                                    +
                                </div>                                        
                            </div>
                            
                            <div id="LikePlaylist" title="Like this playlist" style="@if (User.Identity.IsAuthenticated == false){<text>display:none;</text>} @if (ViewBag.PlaylistLikes == null){<text>display:none;</text>}  display:none;">
                                <div style="float:left; margin:0 5px 0 5px;">
                                    @using (Ajax.BeginForm("AddNewPlaylistLike", "appPlaylist", new AjaxOptions { UpdateTargetId = "LikeNumContH", HttpMethod = "POST", OnComplete = "AddNewPlaylistLikeComplete" }))
                                    {
                                        <!--input id="PlstLikeBtn" type="submit" value="" title="Like & Save" style=" float:left; width:29px; height:29px; background: url('/imgs/player/like_playlist_icn.jpg') no-repeat center; margin:5px 0 0 0; border:none; "  /-->
                                        <input id="PlstLikeBtn" type="submit" value="" title="Like & Save" />
                                        <input type="hidden" name="Playlist_ID" id="Playlist_ID" value="@ViewBag.PlaylistID" />
                                        <input type="hidden" name="Owner_ID" id="Owner_ID" value="@ViewBag.UserID" />
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="MainPlaylistHolder">
                        <div id="PlayerPlaylistHolder1">
                            @for (int i = 0; i < Model.songs_list.Count; i++)
                            {
                                <div id="PlItem_@i" class="playlistItemC">
                                    <img alt="" src="http://i.ytimg.com/vi/@Model.songs_list[i].YoutubeId/0.jpg" onclick="plVClick('@Model.songs_list[i].YoutubeId', @i)" />
                                    <div id="songC_@i" class="songTtl" onclick="plVClick('@Model.songs_list[i].YoutubeId', @i)">
                                        @Model.songs_list[i].Title
                                    </div>
                                    <input type="hidden" id="si_@Model.songs_list[i].YoutubeId" value="@Model.songs_list[i].id" />
                            
                                    <div id="songA_@i" class="skpSngBtn" onclick="skipSong(@i);">
                                        skip
                                    </div>
                                </div>
                            
                                if (i == song_limit)
                                {
                                    <div class="LoadMoreSongs_btn" onclick="LoadMoreSongsPlaylist()" style="float:left; width:98.5%; height:44px; line-height:44px; overflow:hidden; background-color:#454545; margin:0 0 2px 2px; border-radius:1px; text-align:center; cursor:pointer;">
                                        Load More Songs...
                                    </div>
                                    break;
                                }
                            }
                        </div>

                        <div style="display:none; float:left; width:99%; height:33px; margin:3px 0 0 2px; background-color:#232323; border-radius:3px;" >

                            @if (@ViewBag.PlaylistLikes != null)
                            {
                                <!--div class="mplViewsNB">
                                    <div id="LikeNSave">Likes:</div>
                                    <div id="LikeNumContH">@ViewBag.PlaylistLikes</div>
                                </div-->
                            }
                        
                            @if (@ViewBag.PlaylistViews != null)
                            {
                                <!--div class="mplLikesNB">
                                    <div id="ViewsNSave">Views:</div>
                                    <div id="ViewsNumContH">@ViewBag.PlaylistViews</div>
                                </div-->
                            }
                               
                        </div>
                    </div>
                </div>
            </div>
            <div id="RtScrAr" style="display:none; float:left; width:1030px;">
                <div id="currPlS1" style="overflow:hidden; font-weight:bold;">
                    &nbsp;<span style="color:#fcf088;">TAGS:</span> 
                    @if (ViewBag.TagsList != null)
                    {
                        foreach (var item in ViewBag.TagsList)
                        {
                            <span style=" cursor:pointer;" onclick="srchTagS('@item');">@item</span><text>,&nbsp;</text>
                        }
                    }
                </div>

                <div class="exPlInnrCH">
                    <div class="sliderBtnLR" onclick="ScrollContF(this);">></div>
                    <div id="PopPlstsCH1"></div>
                </div>
            </div>

            <div id="tapMessage" style=" display:none; position:absolute; top:250px; left:20px; width:250px; height:80px; line-height:37px; background-color:#CC0000; border-radius:2px; color:#FFFFFF; text-align:center; font-size:30px;">
                <img alt="" src="/imgs/mplUpArrow.png" style=" float:right; margin:-35px -50px 0 0;" />
                Tap here to start video.
            </div>

            <!-- hide back -->
            <div class="Trans_BACK" id="HideBackDiv" onclick="Show_Content();"></div>
            <div id="popupContainer"></div>
            <!-- hide back -->

            <script type="text/javascript">
                var tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                PlbkBar_W = 609;
                volContBar_W = 43;

                curr_playlist_id = '@ViewBag.PlaylistID';
                curr_user_id = '@ViewBag.UserID';
                iua = '@User.Identity.IsAuthenticated';
                desc_length = '@ViewBag.DescLength';
                isNP = 'Y';
                
                function onYouTubeIframeAPIReady() 
                {
                    player = new YT.Player('player', 
                    {
                        width: '320',
                        height: '180',
                        @if (Model.songs_list.Count > 0)
                        {
                            <text>videoId: '@Model.songs_list[0].YoutubeId',</text>
                        }
                        playerVars: { 'autoplay': 0, 'controls': 0, 'enablejsapi' : 1, 'playsinline': 1 },
                        events: {
                            'onReady': onPlayerReady
                        }
                    });
            

                    plTimer = setInterval(function () { currentPlaybackState() }, 1000);

                    PSC1 = document.getElementById("PlaybackStatusCont1");
                    PSC1.addEventListener("click", changePlaybackStatus_Click, false);

                    volCont1 = document.getElementById("VolumeControl");
                    volCont1.addEventListener("click", VolumeControl_Click, false);

                    @if (Model.songs_list.Count > 0)
                    {
                        <text>CURR_VIDEO = 0;</text>
                    }
                }

                function change_player_playlist(object) 
                {
                    window.location = "/m/mplaylists/user/@(ViewBag.Username)?" + object[object.selectedIndex].value;
                }

                var isReady = false;
                function onPlayerReady(event) 
                {
                    if(isReady == false)
                    {
                        player.addEventListener("onStateChange", "onPlayerStateChange");
                        player.addEventListener("onError", "onError");
                        player.setVolume(85);

                        @if (ViewBag.AUTO_PLAY != null && ViewBag.AUTO_PLAY == "0")
                        {
                        }
                        else
                        {

                        }
                        isReady = true;
                        setTimeout(function(){SharesNum()}, 3000);
                    }
                }

                var items_arr = new Array();
                @for (int i = 0; i < Model.songs_list.Count; i++)
                {
                    <text>items_arr[@i] = '@Model.songs_list[i].YoutubeId';</text>


                    if (i == song_limit)
                    {
                        break;
                    }
                }
                if(items_arr.length > 1)
                {
                    $("#Prev_btn").css("display","block");
                    $("#Next_btn").css("display","block");
                    $("#Shuffle_btn").css("display","block");
                }
                else
                {
                    $("#Prev_btn").css("display","none");
                    $("#Next_btn").css("display","none");
                    $("#Shuffle_btn").css("display","none");
                }

                function SharesNum()
                {
                    var shares_num = $('.button-type-post-share .ra1-pw-button-counter-value').html();
                    $.ajax({
                        type: "POST",
                        url: "/playlist/chSSres?PL_ID=" + curr_playlist_id + "&US_ID=" + curr_user_id + "&SN=" + shares_num,
                        async: true,
                        success: function (data) {
                        }
                    });
                }

                function ShuffleSongs()
                {
                    var object = document.getElementById("dr_PlaylistList");
                    $("#PlayerPlaylistHolder1").html("");


                    if (object != null) {
                        $.ajax({
                            type: "POST",
                            url: "/playlist/getPlaylistDetailsPlayer?PL_ID=" + object[object.selectedIndex].value + "&US_ID=@ViewBag.UserID" + "&Sort=Rand",
                            async: true,
                            success: function (data) {
                                $('#PlayerPlaylistHolder1').html(data);
                            }
                        });
                    }
                    else
                    {
                        $.ajax({
                            type: "POST",
                            url: "/playlist/getPlaylistDetailsPlayer?PL_ID=" + curr_playlist_id + "&US_ID=@ViewBag.UserID" + "&Sort=Rand",
                            async: true,
                            success: function (data) {
                                $('#PlayerPlaylistHolder1').html(data);
                            }
                        });
                    }
                }

                function LoadMoreSongsPlaylist()
                {
                    curr_playlist_segment = curr_playlist_segment + 1;
                    $('.LoadMoreSongs_btn').css('display','none');

            
                    $.ajax({
                            type: "POST",
                            url: "/playlist/getPlaylistSegmentPlayer?PL_ID=" + curr_playlist_id + "&US_ID=" + curr_user_id + "&Seg=" + curr_playlist_segment,
                            async: true,
                            success: function (data) {
                                $('#PlayerPlaylistHolder1').append(data);
                            }
                        });
                }

                function srchTagS(p_ss)
                {   
                    $.ajax({
                            type: "POST",
                            url: "/compatibilityCheck/getCompatibleTagsPlaylists/" + p_ss.replace(/^\s\s*/, '').replace(/\s\s*$/, ''),
                            async: true,
                            success: function (data) {
                                $('#PopPlstsCH1').html(data);
                            }
                        });
                }
            </script>
            <div id="TraceTxt" style="display:none;"></div>
            <div class="Trans_BACK" id="HideBackDiv_PopupPlayer" onclick="Show_Content_PopupPlayer();"></div>
            <div id="popupContainer_PopupPlayer"></div>    

            <script type="text/javascript">
                (function (i, s, o, g, r, a, m) {
                    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date(); a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
                })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
                ga('create', 'UA-28695705-1', 'auto', { 'name': 'baron' });
                ga('baron.send', 'pageview');
                ga('create', 'UA-99868480-2', 'auto', { 'name': 'junemedia' });
                ga('junemedia.set', 'dimension5', 'News');
                ga('junemedia.send', 'pageview');
            </script>
        </div>
    </body>
</html>























