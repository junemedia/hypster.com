@{
    Layout = null;
}



<div class="cir_1"> 
    
    <div onclick="clickBack()" style=" float:left; width:100%; margin:100px 0 0 90px; cursor:pointer; ">
        << BACK
    </div>

</div>




<div class="cir_2">


    <div id="msgBox1">
        
        <div style=" float:left; margin:40px 0 0 0;">
            Type your search term<br />
            
            <input type="text" id="searchBar1" name="searchBar1" value="" style=" float:left; width:350px; height:25px; line-height:25px; font-size:18px; " />

            <div onclick="startSearch();" style=" float:left; width:150px; height:30px; line-height:30px; margin:0 0 0 10px; background-color:#CC9933; border-radius:3px; cursor:pointer; text-align:center;">
                Search
            </div>
        </div>

    </div>

</div>








<script type="text/javascript">
    if (is_speech_sound == 1) {
        window.speechSynthesis.cancel();
        var msg = new SpeechSynthesisUtterance('Type your search term.');
        window.speechSynthesis.speak(msg);
    }
</script>


<script type="text/javascript">

    var curr_interval = null;

    function HandleKeyAction(e) {

        var KEY_CODE = 0;

        if (window.event) {
            KEY_CODE = window.event.keyCode;
        }
        else {
            KEY_CODE = e.which;
        }


        //alert(KEY_CODE);
        //alert($("#searchBar1").val());


        //ESC
        if (KEY_CODE == 27) {
            clickBack();
            return;
        }



        if (KEY_CODE == 13) {
            startSearch();
            return;
        }


        if (KEY_CODE == 17) {
            StartVoiceCommand();
            return;
        }



        // if no key pressed then say search phrase
        //
        //------------------------------------------------------------------------------
        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
            clearTimeout(curr_interval);
        }

        curr_interval = setTimeout(function () {
            if (is_speech_sound == 1) {
                var read_search_msg = new SpeechSynthesisUtterance($("#searchBar1").val());
                window.speechSynthesis.speak(read_search_msg);
            }
        }, 500);

        //------------------------------------------------------------------------------

    }


    function clickBack() {
        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
        }

        $.ajax({
            type: "POST",
            url: "/black/bhome/step_2",
            async: true,
            success: function (data) {
                $("#bContHolder1").html(data);
            }
        });
    }


    function startSearch() {
        //!!!
        clearTimeout(curr_interval);

        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
            var search_msg = new SpeechSynthesisUtterance("Wait, searching for " + $("#searchBar1").val());
            window.speechSynthesis.speak(search_msg);
        }

        setTimeout(function () {
            $.ajax({
                type: "POST",
                url: "/black/bListen/artist/" + encodeURI($("#searchBar1").val()) + "?ba=" + encodeURI("/black/bSearch/index"),
                async: true,
                success: function (data) {
                    $("#bContHolder1").html(data);
                }
            });
        }, (1500 + ($("#searchBar1").val().length * 100)));
    }





    function StartVoiceCommand() {


        DisplayMicIcon();   



        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
            var search_msg = new SpeechSynthesisUtterance("say");
            window.speechSynthesis.speak(search_msg);
        }


        setTimeout(function () {
            var recognition = new webkitSpeechRecognition();
            //recognition.continuous = true;
            //recognition.interimResults = true;
            recognition.lang = "en-US";
            recognition.onresult = function (event) {

                var curr_speech = event.results[0][0];
                console.log(event.results[0][0].transcript)

                $("#searchBar1").val(event.results[0][0].transcript);

                clearTimeout(curr_interval);

                if (is_speech_sound == 1) {
                    window.speechSynthesis.cancel();
                    var search_msg = new SpeechSynthesisUtterance("Wait, searching for " + $("#searchBar1").val());
                    window.speechSynthesis.speak(search_msg);
                }

                setTimeout(function () {

                    $.ajax({
                        type: "POST",
                        url: "/black/bListen/artist/" + encodeURI($("#searchBar1").val()) + "?ba=" + encodeURI("/black/bSearch/index"),
                        async: true,
                        success: function (data) {
                            $("#bContHolder1").html(data);
                        }
                    });
                }, (1500 + ($("#searchBar1").val().length * 100)));


            }
            recognition.start();
        }, 300);
    }






    $(document).ready(function () {
        $("#searchBar1").focus();
    });
</script>
