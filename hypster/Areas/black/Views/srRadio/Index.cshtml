@model List<hypster_tv_DAL.MusicGenre>
@{
    Layout = null;

    int i_counter = 1;

    Layout = "/Areas/black/Views/Shared/_srLayout.cshtml";
}



<div class="cir_1"> 
    
    <div onclick="clickBack()" style=" float:left; width:100%; margin:100px 0 0 90px; cursor:pointer; ">
        BACK
    </div>

</div>



<div class="cir_2">

    <div id="msgBox1">

        <div>
            There are <span style=" color:#CC0000; ">@Model.Count</span> Radio stations available.
        </div>


        <br />


        @foreach (var item in Model)
        {
            <div class="mnuItm" id="menu_@(i_counter)" data-plstid="@item.GenreName" data-plstname="@item.GenreName.Replace("\'", "")"  onclick="LoadPlaylist('@item.GenreName')">
                @item.GenreName
            </div>
    
            i_counter += 1;
        }
    
    </div>

</div>









<script type="text/javascript">
    $(document).ready(function () {

        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
            var msg = new SpeechSynthesisUtterance('There are @Model.Count radio stations available.');
            window.speechSynthesis.speak(msg);
        }

    });
</script>


<script type="text/javascript">
    
    var CURR_ACTIVE_MENU = 0;
    var MENU_COUNT = @Model.Count;


    function HandleKeyAction(e) {
        
        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
        }


        var KEY_CODE = 0;

        if (window.event) {
            KEY_CODE = window.event.keyCode;
        }
        else {
            KEY_CODE = e.which;
        }


        //alert(KEY_CODE);


        //ESC
        if (KEY_CODE == 27) {
            clickBack();
        }



        //enter
        if (KEY_CODE == 13) {
            
            //alert($("#menu_" + CURR_ACTIVE_MENU).attr("data-plstid"));
            
            
            //load current playlist
            //--------------------------------------------------------------------
            LoadPlaylist(encodeURI($("#menu_" + CURR_ACTIVE_MENU).attr("data-plstid")));
            //--------------------------------------------------------------------

        }


        //down
        if (KEY_CODE == 40) {
            //move menu down

            CURR_ACTIVE_MENU += 1;
            if (CURR_ACTIVE_MENU > MENU_COUNT) {
                CURR_ACTIVE_MENU = MENU_COUNT;
            }


            if (is_speech_sound == 1) {
                var curr_msg = new SpeechSynthesisUtterance($("#menu_" + CURR_ACTIVE_MENU).attr("data-plstname"));
                window.speechSynthesis.speak(curr_msg);
            }


            $(".mnuItm").css("background", "none");
            $("#menu_" + CURR_ACTIVE_MENU).css("background-color", "#DEDEDE");
        }


        //up
        if (KEY_CODE == 38) {
            //move menu up

            CURR_ACTIVE_MENU -= 1;
            if (CURR_ACTIVE_MENU <= 0) {
                CURR_ACTIVE_MENU = 1;
            }


            if (is_speech_sound == 1) {
                var curr_msg = new SpeechSynthesisUtterance($("#menu_" + CURR_ACTIVE_MENU).attr("data-plstname"));
                window.speechSynthesis.speak(curr_msg);
            }


            $(".mnuItm").css("background", "none");
            $("#menu_" + CURR_ACTIVE_MENU).css("background-color", "#DEDEDE");
        }




        if (KEY_CODE > 48 && KEY_CODE < 58) {
            
            var PLST_NUM = KEY_CODE - 48;

            //load current playlist
            //--------------------------------------------------------------------

            window.location = "/black/srListen/station/" + encodeURI($("#menu_" + PLST_NUM).attr("data-plstid")) + "?ba=" + encodeURI("/black/srRadio");

            //--------------------------------------------------------------------

        }




        if (KEY_CODE == 17) {
            StartVoiceCommand();
            return;
        }



    }


    



    function clickBack(){
        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
        }

        //window.history.back();
        window.location = "/black/srhome/step_2";

    }



    function LoadPlaylist(plst_id)
    {
        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
        }


        window.location = "/black/srListen/station/" + plst_id + "?ba=" + encodeURI("/black/srRadio");

    }






    function StartVoiceCommand() {
        

        DisplayMicIcon();    


        if (is_speech_sound == 1) {
            window.speechSynthesis.cancel();
            var search_msg = new SpeechSynthesisUtterance("say");
            window.speechSynthesis.speak(search_msg);
        }


        setTimeout(function () {
            var recognition = new webkitSpeechRecognition();
            //recognition.continuous = true;
            //recognition.interimResults = true;
            recognition.lang = "en-US";
            recognition.onresult = function (event) {

                var curr_speech = event.results[0][0];
                console.log(event.results[0][0].transcript)

                

                if (is_speech_sound == 1) {
                    window.speechSynthesis.cancel();
                    var search_msg = new SpeechSynthesisUtterance("Wait, searching for " + event.results[0][0].transcript);
                    window.speechSynthesis.speak(search_msg);
                }

                setTimeout(function () {
                    
                    //load current playlist
                    //--------------------------------------------------------------------

                    window.location = "/black/srListen/station/" + encodeURI(event.results[0][0].transcript) + "?ba=" + encodeURI("/black/srRadio");

                    //--------------------------------------------------------------------
                    
                }, 2000);


            }
            recognition.start();
        }, 300);
    }


</script>
